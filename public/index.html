<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chat APP</title>
  <style>
    body {
    height: 100vh;
    background-image: linear-gradient(rgb(255, 255, 255), rgb(109, 39, 239));
}

.logo {
    display: block;
    margin: auto;
    width: 50px;
    height: 50px;
}
h1{
    margin-top: 12px;
    font-size: 30px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
text-align: center;
}
.container {
    max-width: 955px;
    border: 2px solid black;
    padding: 33px;
    overflow-y: auto;
    margin-bottom: 23px;
    margin: auto;
    height: 60vh;
}

.message {
    background-color: grey;
    width: 24%;
    padding: 10px;
    margin: 17px 12px;
    border: 2px solid black;
    border-radius: 10px;
    color: white; /* Ensures text is visible on grey background */
    word-wrap: break-word; /* Ensures long messages wrap to the next line */
}

.left {
    float: left;
    clear: both;
}

.right {
    float: right;
    clear: both;
}

#send-container {
    display: block;
    margin: auto;
    text-align: center;
    max-width: 1085px;
    width: 100%;
}

#messageInp {
    width: 80%;
    border: 2px solid black;
    border-radius: 6px;
    height: 34px;
}

#btn {
    width: 9%;
    cursor: pointer;
    border: 2px solid black;
    border-radius: 6px;
    height: 34px;
}

  </style>
</head>
<body>
  <nav>
    <img class="logo" src="chat.webp" alt="chat image">
    <h1>Welcome to iChat</h1>
</nav>
<div class="container">
</div>
<div class="send">
    <form action="" id="send-container">
        <input type="text" name="messageInp" id="messageInp">
        <button id="btn" type="submit">Send</button>
    </form>
</div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const form = document.querySelector('#send-container');
const messageInp = document.getElementById('messageInp');
const messageContainer = document.querySelector('.container');
var audio = new Audio('nodeServer/livechat-129007.mp3');

const append = (message, position) => {
    const messageElement = document.createElement('div');
    messageElement.innerText = message;
    messageElement.classList.add('message');
    messageElement.classList.add(position);
    messageContainer.append(messageElement);
    if(position == 'left')
       audio.play();
}

form.addEventListener('submit',(e)=>{
e.preventDefault();
const message = messageInp.value;
append(`You: ${message}`, 'right');
socket.emit('send',message);
messageInp.value='';
});

//ask user his name and let server know
const name = prompt("Enter your name to join");
socket.emit('new-user-joined', name);

// if user joins receive name from server 
socket.on('user-joined', name => {
    append(`${name} joined the chat`, 'right');
});

//if user send a message receive it
socket.on('receive', data => {
    append(`${data.name}:${data.message}`, 'left');
});

//if user leave append the info in container
socket.on('left', name=>{
    append(`${name} left the chat`,'right')
})

  </script>
</body>
</html>
